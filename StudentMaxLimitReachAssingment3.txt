trigger StudentMaxLimitReach on Student__c (before insert) 
{
    Map<ID,Integer> classCount = new Map<ID,Integer>();
    Map<ID,Integer> classMaxCountMap = new Map<ID,Integer>();
	List<AggregateResult> classList = [select count(id) , class__c from student__c group by class__c];
    for(AggregateResult Agr: classList)
    {
        classCount.put((ID)Agr.get('class__c'), (Integer)Agr.get('expr0'));
    }
    List<class__c> classMaxCount = [select ID,maxsize__c from class__c];
    for(class__c classCount: classMaxCount)
    {
        classMaxCountMap.put((ID)classCount.ID, (Integer)classCount.maxsize__c);
    }
    
    List<Student__c> updatedStudent = trigger.new;
    for(Student__c st: updatedStudent)
    {
        if(classCount.get(st.Class__c) >= classMaxCountMap.get(st.Class__c) )
        {
            st.addError('Cannot insert more then '+classMaxCountMap.get(st.Class__c) +  ' student');
        }
    }
    
}